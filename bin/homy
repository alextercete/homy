#!/usr/bin/env node

var argv = require('yargs')
  .boolean('d')
  .alias('d', 'dryRun')
  .choices('s', ['convention', 'configuration'])
  .default('s', 'convention')
  .alias('s', 'strategy')
  .argv;

var DryRunSymlinker = require('../lib/dry-run-symlinker');
var FileSystem = require('../lib/file-system');
var Installer = require('../lib/installer');
var OperatingSystem = require('../lib/operating-system');
var Symlinker = require('../lib/symlinker');
var finders = require('../lib/finders');

var fileSystem = new FileSystem();
var operatingSystem = new OperatingSystem();
var finder = finders.create(argv.strategy, fileSystem, operatingSystem);
var symlinker = argv.dryRun ? new DryRunSymlinker() : new Symlinker(fileSystem, operatingSystem);
var installer = new Installer(finder, symlinker);

installer.install()
  .then(function () {
    console.log('Symlinks created successfully!');
  })
  .fail(function (error) {
    console.error(error.message);
  });
